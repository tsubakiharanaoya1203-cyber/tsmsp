<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>日報入力（Excel四角版）</title>
  <style>
    :root{
      --bg:#fff; --text:#111; --muted:#666; --border:#999;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;
      font-size:18px;
    }
    .app-header{position:sticky;top:0;background:#fff;border-bottom:2px solid var(--border);padding:12px 14px;z-index:10;}
    .app-header h1{margin:0;font-size:20px;}
    .main{padding:12px;}
    .note{font-size:13px;color:var(--muted);line-height:1.35;margin:8px 0;}
    /* Excel-ish panels */
    .wf-panel{border:2px solid var(--border);background:#fff;margin:10px 0;padding:10px;}
    .wf-label{font-weight:800;font-size:16px;margin:0 0 8px 0;}
    .wf-subnote{font-size:12px;color:var(--muted);margin:-2px 0 8px 0;}
    /* Square buttons (no rounding) */
    .wf-row{display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;}
    .btn{appearance:none;-webkit-appearance:none;border:2px solid var(--border);background:#fff;
      border-radius:0;padding:14px 8px;font-size:16px;min-height:56px;
    }
    .btn.is-selected{border:4px solid #00ff00;}
    .wf-form{display:grid;gap:10px;}
    .wf-field{display:grid;gap:6px;}
    .wf-field-label{font-size:13px;color:var(--muted);}
    .input{width:100%;box-sizing:border-box;border:2px solid var(--border);border-radius:0;
      padding:14px 10px;font-size:20px;min-height:56px;background:#fff;
    }
    .wf-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px;}
    .is-hidden{display:none !important;}
    /* Keypad 3x3 + bottom row */
    .keypad{margin-top:10px;border-top:2px solid var(--border);padding-top:10px;}
    .keypad-grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;}
    .key{border:2px solid var(--border);border-radius:0;background:#fff;
      min-height:60px;font-size:22px;
    }
    .key.small{font-size:16px;}
    @media (max-width: 420px){
      .wf-row{grid-template-columns:repeat(4, 1fr);}
      .btn{font-size:15px;min-height:52px;padding:12px 6px;}
    }
    @media (min-width: 768px){
      html{font-size:20px;}
      .main{max-width:880px;margin:0 auto;}
      .btn{font-size:18px;min-height:64px;}
      .input{font-size:22px;min-height:64px;}
      .key{min-height:72px;font-size:26px;}
    }
  
/* ---- TSMS Hamburger Menu (overlay) ---- */
.tsms-header{
  position:sticky; top:0; z-index:100;
  height:60px; background:#fff;
  border-bottom:2px solid #000;
  display:flex; align-items:center;
  padding:0 14px 0 56px;
  font-weight:900; font-size:20px;
}
.tsms-hamburger{
  position:absolute; left:14px; top:50%;
  transform:translateY(-50%);
  width:32px; height:24px;
  display:flex; flex-direction:column; justify-content:space-between;
  cursor:pointer; user-select:none;
}
.tsms-hamburger span{ height:3px; background:#000; display:block; }
.tsms-menu{
  position:fixed; top:0; left:0; height:100%; width:280px;
  background:#fff; border-right:2px solid #000;
  transform:translateX(-100%);
  transition:transform .25s ease;
  z-index:1000; padding-top:60px;
}
.tsms-menu.open{ transform:translateX(0); }
.tsms-menu a{
  display:block; padding:16px;
  border-bottom:1px solid #ddd;
  text-decoration:none; color:#000;
  font-size:18px; font-weight:900;
}
.tsms-menu-bg{
  position:fixed; inset:0;
  background:rgba(0,0,0,.25);
  opacity:0; pointer-events:none;
  transition:opacity .2s ease;
  z-index:900;
}
.tsms-menu-bg.show{ opacity:1; pointer-events:auto; }
.tsms-build{ font-size:12px; color:#666; padding:8px 12px; }
/* -------------------------------------- */

</style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TSMS">

</head>
<body>

<nav class="tsms-menu" id="tsmsMenu" aria-label="サイドメニュー">
  <a href="index.html">TOP</a>
  <a href="report.html">日報入力</a>
  <a href="confirm.html">入力確認</a>
  <a href="detail.html">詳細確認</a>
  <a href="ops.html">出庫/帰庫/休憩</a>
  <a href="sales.html">売上</a>
  <a href="settings.html">設定</a>
</nav>
<div class="tsms-menu-bg" id="tsmsMenuBg" aria-hidden="true"></div>

<header class="tsms-header">
  <div class="tsms-hamburger" id="tsmsHamburger" role="button" tabindex="0" aria-label="メニュー">
    <span></span><span></span><span></span>
  </div>
  日報入力
</header>
<div class="tsms-build"></div>
  </header>

  <main class="main">
    <section class="wf-panel" id="sec_rideType">
      <div class="wf-label">乗車種別</div>
      <div class="wf-row">
        <button class="btn" type="button" data-group="rideType" data-value="無線">無線</button><button class="btn" type="button" data-group="rideType" data-value="付待">付待</button><button class="btn" type="button" data-group="rideType" data-value="流し">流し</button><button class="btn" type="button" data-group="rideType" data-value="乗場">乗場</button><button class="btn" type="button" data-group="rideType" data-value="連続">連続</button><button class="btn" type="button" data-group="rideType" data-value="会社">会社</button><button class="btn" type="button" data-group="rideType" data-value="予約">予約</button><button class="btn" type="button" data-group="rideType" data-value="GO">GO</button>
      </div>
    </section>

    <section class="wf-panel" id="sec_payMethod">
      <div class="wf-label">支払方法</div>
      <div class="wf-row">
        <button class="btn" type="button" data-group="payMethod" data-value="現金">現金</button><button class="btn" type="button" data-group="payMethod" data-value="QR">QR</button><button class="btn" type="button" data-group="payMethod" data-value="クレカ">クレカ</button><button class="btn" type="button" data-group="payMethod" data-value="電子M">電子M</button><button class="btn" type="button" data-group="payMethod" data-value="チケット他">チケット他</button><button class="btn" type="button" data-group="payMethod" data-value="会社">会社</button><button class="btn" type="button" data-group="payMethod" data-value="予約">予約</button><button class="btn" type="button" data-group="payMethod" data-value="GO">GO Pay</button><button class="btn" type="button" data-group="payMethod" data-value="乗込GO Pay">乗込GO Pay</button>
      </div>
    </section>

    <section class="wf-panel is-hidden" id="sec_ticketSub">
      <div class="wf-label">チケット他（追加選択）</div>
      <div class="wf-subnote">※「チケット他」選択時のみ表示</div>
      <div class="wf-row">
        <button class="btn" type="button" data-group="ticketSub" data-value="Aチケット">Aチケット</button><button class="btn" type="button" data-group="ticketSub" data-value="自社チケット">自社チケット</button><button class="btn" type="button" data-group="ticketSub" data-value="臨時チケット">臨時チケット</button><button class="btn" type="button" data-group="ticketSub" data-value="JCBチケット">JCBチケット</button><button class="btn" type="button" data-group="ticketSub" data-value="福祉チケット">福祉チケット</button><button class="btn" type="button" data-group="ticketSub" data-value="社内扱い">社内扱い</button><button class="btn" type="button" data-group="ticketSub" data-value="その他">その他</button><button class="btn" type="button" data-group="ticketSub" data-value="GOチケット">GOチケット</button>
      </div>
    </section>

    <section class="wf-panel" id="sec_amounts">
      <div class="wf-label">金額入力</div>

      <div class="wf-form">
        <div class="wf-field" id="row_cash">
          <div class="wf-field-label">現収（数字のみ）</div>
          <input class="input" id="in_cash" inputmode="numeric" placeholder="0">
        </div>

        <div class="wf-field" id="row_credit">
          <div class="wf-field-label">未収（数字のみ）</div>
          <input class="input" id="in_credit" inputmode="numeric" placeholder="0">
        </div>

        <div class="wf-field">
          <div class="wf-field-label">備考</div>
          <input class="input" id="in_note" placeholder="メモ">
        </div>

        <div class="wf-actions">
          <button class="btn" type="button" id="btn_clear">入力をクリア</button>
          <button class="btn" type="button" id="btn_submit">登録する</button>
        </div>
      </div>

      <div class="keypad" id="keypad">
        <div class="note">テンキー（選択中の入力欄に入ります）</div>
        <div class="keypad-grid">
          <button class="key" type="button" data-key="1">1</button>
          <button class="key" type="button" data-key="2">2</button>
          <button class="key" type="button" data-key="3">3</button>
          <button class="key" type="button" data-key="4">4</button>
          <button class="key" type="button" data-key="5">5</button>
          <button class="key" type="button" data-key="6">6</button>
          <button class="key" type="button" data-key="7">7</button>
          <button class="key" type="button" data-key="8">8</button>
          <button class="key" type="button" data-key="9">9</button>
          <button class="key small" type="button" data-key="clear">C</button>
          <button class="key" type="button" data-key="0">0</button>
          <button class="key small" type="button" data-key="back">←</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== Rules + keypad (self-contained) =====
    const state = {rideType:"", payMethod:"", ticketSub:""};
    const secTicket = document.getElementById("sec_ticketSub");
    const rowCash = document.getElementById("row_cash");
    const rowCredit = document.getElementById("row_credit");
    const inCash = document.getElementById("in_cash");
    const inCredit = document.getElementById("in_credit");
    const inNote = document.getElementById("in_note");
    let focused = inCash;

    function clearSelected(group){
      document.querySelectorAll(`button[data-group="${group}"]`).forEach(b=>b.classList.remove("is-selected"));
    }
    
function selectBtn(group, btn){
  const already = btn.classList.contains("is-selected");
  clearSelected(group);
  if(!already){
    btn.classList.add("is-selected");
    return true; // now selected
  }
  return false; // now unselected
}

    function applyPayRules(){
      if(state.payMethod === "チケット他") secTicket.classList.remove("is-hidden");
      else secTicket.classList.add("is-hidden");

      if(state.payMethod === "現金"){
        rowCash.classList.remove("is-hidden");
        rowCredit.classList.add("is-hidden");
        focused = inCash;
      } else if(state.payMethod === "チケット他"){
        rowCash.classList.remove("is-hidden");
        rowCredit.classList.remove("is-hidden");
        focused = inCredit;
      } else {
        rowCash.classList.add("is-hidden");
        rowCredit.classList.remove("is-hidden");
        focused = inCredit;
      }

    const secAmounts = document.getElementById("sec_amounts");

    function scrollToAmountsIfReady(){
      // 乗車種別＋支払方法が両方決まったら、金額入力へスクロール＆フォーカス
      if(!state.rideType || !state.payMethod) return;
      // DOMの表示切替が反映されてからスクロールしたいので少し待つ
      setTimeout(()=>{
        if(secAmounts) secAmounts.scrollIntoView({behavior:"smooth", block:"start"});
        // 表示されている入力にフォーカス
        if(state.payMethod === "現金") inCash.focus();
        else inCredit.focus();
      }, 50);
    }

    }

    document.addEventListener("click", (e)=>{
      const btn = e.target.closest("button[data-group]");
      
if(btn){
  const g = btn.dataset.group;
  const v = btn.dataset.value || btn.textContent.trim();

  const selected = selectBtn(g, btn);

  if(g === "rideType") state.rideType = selected ? v : "";
  if(g === "payMethod"){
    state.payMethod = selected ? v : "";
    if(!selected){
      state.ticketSub = "";
      clearSelected("ticketSub");
    }
    applyPayRules();
  }
  if(g === "ticketSub") state.ticketSub = selected ? v : "";

  if((g === "rideType" || g === "payMethod") && selected){
    scrollToAmountsIfReady();
  }
  return;
}


      const keyBtn = e.target.closest("button[data-key]");
      if(keyBtn){
        const k = keyBtn.dataset.key;
        if(!focused) return;
        const cur = String(focused.value||"");
        if(k === "clear") focused.value = "";
        else if(k === "back") focused.value = cur.slice(0,-1);
        else if(/^[0-9]$/.test(k)) focused.value = cur + k;
        focused.focus();
        return;
      }
    });

    [inCash, inCredit].forEach(inp=>{
      inp.addEventListener("focus", ()=>focused = inp);
      inp.addEventListener("click", ()=>focused = inp);
    });

    document.getElementById("btn_clear").addEventListener("click", ()=>{
      state.rideType=""; state.payMethod=""; state.ticketSub="";
      document.querySelectorAll("button").forEach(b=>b.classList.remove("is-selected"));
      inCash.value=""; inCredit.value=""; inNote.value="";
      rowCash.classList.remove("is-hidden");
      rowCredit.classList.remove("is-hidden");
      secTicket.classList.add("is-hidden");
      focused = inCash;
    });

    document.getElementById("btn_submit").addEventListener("click", ()=>{
      // --- Save to localStorage (for GitHub Pages review) ---
      if(!state.rideType || !state.payMethod){
        alert("乗車種別と支払方法を選んでください");
        return;
      }

      const cash = (inCash.value||"").trim();
      const credit = (inCredit.value||"").trim();

      if(!cash && !credit){
        alert("現収か未収のどちらかに金額を入力してください");
        return;
      }

      const now = new Date();
      const hh = String(now.getHours()).padStart(2,"0");
      const mm = String(now.getMinutes()).padStart(2,"0");

      const entry = {
        id: (crypto && crypto.randomUUID) ? crypto.randomUUID() : (Date.now()+"-"+Math.random().toString(16).slice(2)),
        time: `${hh}:${mm}`,
        ts: now.toISOString(),
        rideType: state.rideType,
        payMethod: state.payMethod,
        ticketSub: state.ticketSub || "",
        cash: cash ? Number(cash.replace(/[^0-9]/g,"")) : 0,
        credit: credit ? Number(credit.replace(/[^0-9]/g,"")) : 0,
        note: (inNote.value||"").trim()
      };

      const params = new URLSearchParams(location.search);
      const editId = params.get("edit");

      let list = [];
      try { list = JSON.parse(localStorage.getItem("tsms_reports") || "[]"); } catch(e) { list = []; }

      if(editId){
        const idx = list.findIndex(x=>x.id===editId);
        if(idx >= 0){
          entry.id = editId;
          list[idx] = entry;
        } else {
          list.unshift(entry);
        }
        localStorage.removeItem("tsms_edit_id");
      } else {
        list.unshift(entry);
      }

      localStorage.setItem("tsms_reports", JSON.stringify(list));

      // clear form (keep UI rules)
      document.getElementById("btn_clear").click();

      // go confirm
      location.href = "confirm.html";
    });

    
    // --- Load for edit (from confirm page) ---
    (function(){
      const params = new URLSearchParams(location.search);
      const editId = params.get("edit");
      if(!editId) return;

      let list = [];
      try { list = JSON.parse(localStorage.getItem("tsms_reports") || "[]"); } catch(e) { list = []; }
      const e = list.find(x=>x.id===editId);
      if(!e) return;

      // restore selections
      state.rideType = e.rideType || "";
      state.payMethod = e.payMethod || "";
      state.ticketSub = e.ticketSub || "";

      // select buttons by matching dataset value/text
      document.querySelectorAll('button[data-group="rideType"]').forEach(b=>{
        const v = b.dataset.value || b.textContent.trim();
        if(v === state.rideType) { b.classList.add("is-selected"); }
      });
      document.querySelectorAll('button[data-group="payMethod"]').forEach(b=>{
        const v = b.dataset.value || b.textContent.trim();
        if(v === state.payMethod) { b.classList.add("is-selected"); }
      });

      applyPayRules();
      if(state.payMethod === "チケット"){
        secTicket.classList.remove("is-hidden");
        document.querySelectorAll('button[data-group="ticketSub"]').forEach(b=>{
          const v = b.dataset.value || b.textContent.trim();
          if(v === state.ticketSub) { b.classList.add("is-selected"); }
        });
      }

      inCash.value = e.cash ? String(e.cash) : "";
      inCredit.value = e.credit ? String(e.credit) : "";
      inNote.value = e.note || "";
      focused = inCash;

      // scroll to amounts
      setTimeout(scrollToAmountsIfReady, 50);
    })();


    // init
    secTicket.classList.add("is-hidden");
    applyPayRules();
  </script>

<script>
(function(){
  const menu = document.getElementById("tsmsMenu");
  const bg = document.getElementById("tsmsMenuBg");
  const burger = document.getElementById("tsmsHamburger");
  if(!menu || !bg || !burger) return;

  function openMenu(){ menu.classList.add("open"); bg.classList.add("show"); }
  function closeMenu(){ menu.classList.remove("open"); bg.classList.remove("show"); }

  burger.addEventListener("click", openMenu);
  burger.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openMenu(); });
  bg.addEventListener("click", closeMenu);
  menu.querySelectorAll("a").forEach(a=>a.addEventListener("click", closeMenu));
})();
</script>




<script>
/* --- Scroll fix (ONLY): rideType + payMethod + ticketSub -> scroll control --- */
(function(){
  const secAmounts = document.getElementById("sec_amounts");
  const secTicketSub = document.getElementById("sec_ticketSub");
  const rowCash = document.getElementById("row_cash");
  const rowCredit = document.getElementById("row_credit");
  const inCash = document.getElementById("in_cash");
  const inCredit = document.getElementById("in_credit");

  function isVisible(el){
    return el && !el.classList.contains("is-hidden") && el.offsetParent !== null;
  }

  function getSelectedValue(group){
    const b = document.querySelector(`button[data-group="${group}"].is-selected`);
    return b ? (b.dataset.value || b.textContent.trim()) : "";
  }

  function scrollToAmounts(){
    let target = null;
    const pay = getSelectedValue("payMethod");
    const cashVisible = isVisible(rowCash);
    const creditVisible = isVisible(rowCredit);

    if(cashVisible && pay === "現金") target = inCash;
    else if(creditVisible) target = inCredit;
    else if(cashVisible) target = inCash;
    else target = inCredit || inCash;

    if(secAmounts){
      secAmounts.scrollIntoView({behavior:"smooth", block:"start"});
    } else if(target){
      target.scrollIntoView({behavior:"smooth", block:"center"});
    }

    setTimeout(()=>{
      try{
        if(target){
          target.focus({preventScroll:true});
          if(typeof target.select === "function") target.select();
        }
      }catch(e){}
    }, 120);
  }

  function run(){
    const ride = getSelectedValue("rideType");
    const pay  = getSelectedValue("payMethod");
    const ticketSub = getSelectedValue("ticketSub");

    if(!ride || !pay) return;

    // ① チケット他 → 追加選択へ
    if(pay === "チケット他" && !ticketSub && isVisible(secTicketSub)){
      secTicketSub.scrollIntoView({behavior:"smooth", block:"start"});
      return;
    }

    // ② チケット他で追加選択完了 → 金額入力へ
    if(pay === "チケット他" && ticketSub){
      scrollToAmounts();
      return;
    }

    // ③ 通常 → 金額入力へ
    scrollToAmounts();
  }

  document.addEventListener("click", (e)=>{
    const btn = e.target.closest('button[data-group="rideType"],button[data-group="payMethod"],button[data-group="ticketSub"]');
    if(!btn) return;
    setTimeout(run, 0);
  }, true);
})();
</script>




<script>
/* --- Clear confirm dialog ONLY --- */
(function(){
  const btn = document.getElementById("btn_clear");
  if(!btn) return;

  btn.addEventListener("click", function(e){
    // stop original handler temporarily
    e.stopImmediatePropagation();

    const ok = true;
    if(ok){
      // trigger original click again without this interceptor
      btn.removeEventListener("click", arguments.callee, true);
      btn.click();
    }
    // if cancel: do nothing
  }, true);
})();
</script>



<script>
/* --- Register confirm + save + success + delayed redirect ONLY --- */
(function(){
  const btn = document.getElementById("btn_submit");
  if(!btn) return;

  // avoid double-binding
  if(btn.dataset.boundRegisterConfirm === "1") return;
  btn.dataset.boundRegisterConfirm = "1";

  btn.addEventListener("click", function(e){
    // block other handlers so we control register flow
    e.preventDefault();
    e.stopImmediatePropagation();

    const ok = confirm("登録しますか？\n\nはい = OK\nいいえ = キャンセル");
    if(!ok) return;

    try{
      const ride = document.querySelector('button[data-group="rideType"].is-selected');
      const pay  = document.querySelector('button[data-group="payMethod"].is-selected');
      const ticket = document.querySelector('button[data-group="ticketSub"].is-selected');

      const cash = document.getElementById("in_cash")?.value || "";
      const credit = document.getElementById("in_credit")?.value || "";

      const record = {
        time: new Date().toLocaleTimeString("ja-JP", {hour:"2-digit", minute:"2-digit"}),
        rideType: ride ? (ride.dataset.value || ride.innerText.trim()) : "",
        payMethod: pay ? (pay.dataset.value || pay.innerText.trim()) : "",
        ticketSub: ticket ? (ticket.dataset.value || ticket.innerText.trim()) : "",
        cash: cash,
        credit: credit,
        ts: new Date().toISOString()
      };

      const KEY = "tsms_reports";
      const EDIT_INDEX_KEY = "tsms_edit_index";
      const EDIT_RECORD_KEY = "tsms_edit_record";
      const list = JSON.parse(localStorage.getItem(KEY) || "[]");
      const editIdxRaw = localStorage.getItem(EDIT_INDEX_KEY);
      const editIdx = (editIdxRaw !== null && editIdxRaw !== "") ? Number(editIdxRaw) : null;
      if(editIdx !== null && !Number.isNaN(editIdx) && list[editIdx]){
        list[editIdx] = record; // order unchanged
        localStorage.removeItem(EDIT_INDEX_KEY);
        localStorage.removeItem(EDIT_RECORD_KEY);
      } else {
        list.push(record);
      }
      localStorage.setItem(KEY, JSON.stringify(list));

      alert("登録しました！");

      setTimeout(()=>{
        location.href = "confirm.html";
      }, 3000);

    }catch(err){
      console.error("register confirm error", err);
      alert("登録に失敗しました（エラー）");
    }
  }, true);
})();
</script>




<script>
/* --- Clear confirm dialog (FIX): actually clears all selected + amounts --- */
(function(){
  const btn = document.getElementById("btn_clear");
  if(!btn) return;

  // bind once
  if(btn.dataset.boundClearConfirmFix === "1") return;
  btn.dataset.boundClearConfirmFix = "1";

  btn.addEventListener("click", function(e){
    // take over clear flow, keep everything else unchanged
    e.preventDefault();
    e.stopImmediatePropagation();

    const ok = confirm("削除してよろしいですか？\n\nいいえ = キャンセル\nはい = OK");
    if(!ok) return;

    try{
      // Use existing globals/ids from the page (do not change any other behavior)
      // state / rowCash / rowCredit / secTicket / inCash / inCredit / inNote / focused are defined in the main script scope.
      if(typeof state === "object"){
        state.rideType = "";
        state.payMethod = "";
        state.ticketSub = "";
      }

      document.querySelectorAll("button").forEach(b=>b.classList.remove("is-selected"));

      const inCash = document.getElementById("in_cash");
      const inCredit = document.getElementById("in_credit");
      const inNote = document.getElementById("in_note");
      if(inCash) inCash.value = "";
      if(inCredit) inCredit.value = "";
      if(inNote) inNote.value = "";

      const rowCash = document.getElementById("row_cash");
      const rowCredit = document.getElementById("row_credit");
      const secTicket = document.getElementById("sec_ticketSub");

      if(rowCash) rowCash.classList.remove("is-hidden");
      if(rowCredit) rowCredit.classList.remove("is-hidden");
      if(secTicket) secTicket.classList.add("is-hidden");

      // reset focus to cash
      try{
        if(inCash){
          inCash.focus({preventScroll:true});
          if(typeof inCash.select === "function") inCash.select();
        }
      }catch(err){}
    }catch(err){
      console.error("clear fix error", err);
    }
  }, true);
})();
</script>


<script>
/* --- Prefill for edit (ONLY) --- */
(function(){
  const EDIT_RECORD_KEY = "tsms_edit_record";
  const raw = localStorage.getItem(EDIT_RECORD_KEY);
  if(!raw) return;

  let rec = null;
  try{ rec = JSON.parse(raw); }catch(e){ return; }
  if(!rec) return;

  // Helper: click button by group + label/value (uses existing logic)
  function clickMatch(group, value){
    const btns = Array.from(document.querySelectorAll(`button[data-group="${group}"]`));
    const b = btns.find(x => (x.dataset.value||"").trim() === String(value).trim())
          || btns.find(x => (x.textContent||"").trim() === String(value).trim());
    if(b) b.click();
  }

  // Prefill selections
  if(rec.rideType) clickMatch("rideType", rec.rideType);
  if(rec.payMethod) clickMatch("payMethod", rec.payMethod);
  if(rec.ticketSub) clickMatch("ticketSub", rec.ticketSub);

  // Prefill amounts & note
  const inCash = document.getElementById("in_cash");
  const inCredit = document.getElementById("in_credit");
  const inNote = document.getElementById("in_note");
  if(inCash) inCash.value = rec.cash || "";
  if(inCredit) inCredit.value = rec.credit || "";
  if(inNote) inNote.value = rec.note || "";

  // Focus appropriate input
  setTimeout(()=>{
    try{
      if(inCredit && rec.credit){
        inCredit.focus({preventScroll:true});
        if(typeof inCredit.select === "function") inCredit.select();
      } else if(inCash){
        inCash.focus({preventScroll:true});
        if(typeof inCash.select === "function") inCash.select();
      }
    }catch(e){}
  }, 150);
})();
</script>


  <script>
    (function(){if('serviceWorker'in navigator&&location.protocol.indexOf('http')===0){window.addEventListener('load',function(){navigator.serviceWorker.register('./sw.js').catch(function(){});});}})();
  </script>

</body>
</html>
