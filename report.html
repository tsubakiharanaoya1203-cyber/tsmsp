<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—¥å ±å…¥åŠ›ï¼ˆExcelå››è§’ç‰ˆï¼‰</title>
  <style>
    :root{ --bg:#fff; --text:#111; --muted:#666; --border:#999; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:"Noto Sans JP", sans-serif;
      font-size:18px;
    }
    .main{padding:12px;}
    .note{font-size:13px;color:var(--muted);line-height:1.35;margin:8px 0;}
    .wf-panel{border:2px solid var(--border);background:#fff;margin:10px 0;padding:10px;}
    .wf-label{font-weight:800;font-size:16px;margin:0 0 8px 0;}
    .wf-subnote{font-size:12px;color:var(--muted);margin:-2px 0 8px 0;}
    .wf-row{display:grid;grid-template-columns:repeat(4, 1fr);gap:8px;}
    .btn{appearance:none;-webkit-appearance:none;border:2px solid var(--border);background:#fff;
      border-radius:0;padding:14px 8px;font-size:16px;min-height:56px;
    }
    .btn.is-selected{border:2px solid #1A7A28;background:#1F9A33!important;color:#fff!important;}
    .wf-form{display:grid;gap:10px;}
    .wf-field{display:grid;gap:6px;}
    .wf-field-label{font-size:13px;color:var(--muted);}
    .input{width:100%;box-sizing:border-box;border:2px solid var(--border);border-radius:0;
      padding:14px 10px;font-size:20px;min-height:56px;background:#fff;
    }
    .wf-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:6px;}
    .is-hidden{display:none !important;}
    .keypad{margin-top:10px;border-top:2px solid var(--border);padding-top:10px;}
    .keypad-grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:8px;}
    .key{border:2px solid var(--border);border-radius:0;background:#fff;min-height:60px;font-size:22px;}
    .key.small{font-size:16px;}
    @media (max-width: 420px){
      .wf-row{grid-template-columns:repeat(4, 1fr);}
      .btn{font-size:15px;min-height:52px;padding:12px 6px;}
    }
    @media (min-width: 768px){
      html{font-size:20px;}
      .main{max-width:880px;margin:0 auto;}
      .btn{font-size:18px;min-height:64px;}
      .input{font-size:22px;min-height:64px;}
      .key{min-height:72px;font-size:26px;}
    }

    .tsms-header{
      position:sticky; top:0; z-index:100;
      height:60px; background:#fff;
      border-bottom:2px solid #000;
      display:flex; align-items:center;
      padding:0 14px 0 56px;
      font-weight:900; font-size:20px;
    }
    .header-to-report{
      margin-left:auto;
      border:2px solid #000;
      padding:6px 10px;
      font-size:14px;
      font-weight:900;
      color:#000;
      text-decoration:none;
      line-height:1.2;
      background:#fff;
    }
    .tsms-hamburger{
      position:absolute; left:14px; top:50%;
      transform:translateY(-50%);
      width:32px; height:24px;
      display:flex; flex-direction:column; justify-content:space-between;
      cursor:pointer; user-select:none;
    }
    .tsms-hamburger span{ height:3px; background:#000; display:block; }
    .tsms-menu{
      position:fixed; top:0; left:0; height:100%; width:280px;
      background:#fff; border-right:2px solid #000;
      transform:translateX(-100%);
      transition:transform .25s ease;
      z-index:1000; padding-top:60px;
    }
    .tsms-menu.open{ transform:translateX(0); }
    .tsms-menu a{
      display:block; padding:16px;
      border-bottom:1px solid #ddd;
      text-decoration:none; color:#000;
      font-size:18px; font-weight:900;
    }
    .tsms-menu small{ display:block; margin-top:2px; font-size:12px; font-weight:700; color:#666; }
    .tsms-menu-bg{
      position:fixed; inset:0;
      background:rgba(0,0,0,.25);
      opacity:0; pointer-events:none;
      transition:opacity .2s ease;
      z-index:900;
    }
    .tsms-menu-bg.show{ opacity:1; pointer-events:auto; }
  /* ---- Theme tokens ---- */
:root{
  --bg:#F3F6F8;
  --surface-1:#FFFFFF;
  --surface-2:#EEF3F6;
  --border:#D5DEE6;
  --text-primary:#0F1720;
  --text-secondary:#344554;
  --text-muted:#5B6D7C;
  --accent:#2580ED;
  --accent-hover:#4DA3FF;
  --link:#187FBF;
}
:root[data-theme="dark"]{
  --bg:#0F1417;
  --surface-1:#151C20;
  --surface-2:#1B242A;
  --border:#2A353D;
  --text-primary:#E6EEF3;
  --text-secondary:#B7C4CC;
  --text-muted:#8A949A;
  --accent:#3B95F0;
  --accent-hover:#4DA3FF;
  --link:#58C2FF;
}
html,body{ background:var(--bg)!important; color:var(--text-primary)!important; }
a{ color:var(--link); }
.tsms-header,.header,.app-header,.card,.wf-panel,.section,.date-switcher,.menu,.tsms-menu,.box{background:var(--surface-1)!important;border-color:var(--border)!important;color:var(--text-primary)!important;}
.note,.wf-field-label,.label,.k,.idx,.desc,.wf-subnote,.wf-field-label{color:var(--text-muted)!important;}
.tsms-menu a,.menu a,.header-to-report,.btn,.actionBtn,.key,.input,select,.key.small{background:var(--surface-2)!important;color:var(--text-primary)!important;border-color:var(--border)!important;}
.menu small,.tsms-menu small{color:var(--text-muted)!important;}
.btn.next{background:var(--accent)!important;border-color:var(--accent)!important;color:#fff!important;}
.menu-bg,.tsms-menu-bg{background:rgba(15,23,32,.35)!important;}

.hamburger span,.tsms-hamburger span{background:#58C2FF!important;}
/* ---- Theme tokens end ---- */

</style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TSMS">
  <script>(function(){try{var t=localStorage.getItem("tsms_theme")==="dark"?"dark":"light";document.documentElement.setAttribute("data-theme",t);var m=document.querySelector('meta[name="theme-color"]');if(m)m.setAttribute("content",t==="dark"?"#0F1417":"#F3F6F8");}catch(e){}})();</script>

<style id="tsms-bottom-nav-style">
  body{padding-bottom:78px;}
  .tsms-hamburger,.hamburger,.tsms-menu,.menu,.tsms-menu-bg,.menu-bg{display:none!important;}
  .tsms-header,.header{padding-left:14px!important;}
  .tsms-header::before,.header::before{content:"";display:inline-block;width:22px;height:22px;flex:0 0 22px;margin-right:8px;background:url('icon.png') center/contain no-repeat;}
  .tsms-bottom-nav{position:fixed;left:0;right:0;bottom:0;z-index:1200;display:grid;grid-template-columns:repeat(5,1fr);background:var(--surface-1,#fff);border-top:2px solid var(--border,#ccc);padding-bottom:env(safe-area-inset-bottom);}
  .tsms-bottom-nav a,.tsms-bottom-nav button{appearance:none;border:0;background:transparent;color:var(--text-secondary,#445);font:inherit;font-size:11px;font-weight:900;padding:8px 2px 9px;min-height:58px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;text-decoration:none;}
  .tsms-bottom-nav .ico{width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center;color:#58C2FF;}
  .tsms-bottom-nav .ico svg{width:22px;height:22px;stroke:#58C2FF;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;display:block;}
  .tsms-bottom-nav .active{color:var(--text-primary,#111);position:relative;}
  .tsms-bottom-nav .active::before{content:"";position:absolute;top:0;left:14%;right:14%;height:2px;background:#58C2FF;}
  .tsms-more-sheet{position:fixed;left:0;right:0;bottom:0;z-index:1300;background:var(--surface-1,#fff);border-top:2px solid var(--border,#ccc);transform:translateY(110%);transition:transform .2s ease;padding:12px 12px calc(12px + env(safe-area-inset-bottom));}
  .tsms-more-sheet.show{transform:translateY(0);}
  .tsms-more-sheet a{display:block;padding:12px;border:2px solid var(--border,#ccc);margin-top:8px;text-decoration:none;color:var(--text-primary,#111);background:var(--surface-2,#f5f5f5);font-weight:900;}
  .tsms-more-bg{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;z-index:1250;transition:opacity .2s;}
  .tsms-more-bg.show{opacity:1;pointer-events:auto;}
</style>

  <script type="module" src="auth-guard.js"></script>
</head>
<body>
<nav class="tsms-menu" id="tsmsMenu" aria-label="ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
  <a href="index.html">TOP<small>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§</small></a>
  <a href="report.html">æ—¥å ±å…¥åŠ›<small>ä¹—è»Šãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›</small></a>
  <a href="confirm.html">å…¥åŠ›ç¢ºèª<small>å½“æ—¥ãƒ»éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª</small></a>
  <a href="detail.html">è©³ç´°ç¢ºèª<small>æ¦‚ç®—æ‰‹å–ã€é›†è¨ˆçµæœãªã©</small></a>
  <a href="ops.html">å‡ºåº« / å¸°åº« / ä¼‘æ†©<small>ä¼‘æ†©ã‚¿ã‚¤ãƒãƒ¼ãªã©</small></a>
  <a href="sales.html">æœˆé–“ç®¡ç†<small>å½“æœˆã€éå»ã®å£²ä¸Šç¢ºèª</small></a>
  <a href="settings.html">è¨­å®š<small>æ­©ç‡ã€ç· ã‚æœŸé–“ã€ã‚·ãƒ•ãƒˆãªã©</small></a>
</nav>
<div class="tsms-menu-bg" id="tsmsMenuBg" aria-hidden="true"></div>

<header class="tsms-header">
  <div class="tsms-hamburger" id="tsmsHamburger" role="button" tabindex="0" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
    <span></span><span></span><span></span>
  </div>
  æ—¥å ±å…¥åŠ›
  <a class="header-to-report" href="report.html">å…¥åŠ›ç”»é¢ã¸</a>
</header>

<main class="main">
  <section class="wf-panel" id="sec_rideType">
    <div class="wf-label">ä¹—è»Šç¨®åˆ¥</div>
    <div class="wf-row">
      <button class="btn" type="button" data-group="rideType" data-value="ç„¡ç·š">ç„¡ç·š</button><button class="btn" type="button" data-group="rideType" data-value="ä»˜å¾…">ä»˜å¾…</button><button class="btn" type="button" data-group="rideType" data-value="æµã—">æµã—</button><button class="btn" type="button" data-group="rideType" data-value="ä¹—å ´">ä¹—å ´</button><button class="btn" type="button" data-group="rideType" data-value="é€£ç¶š">é€£ç¶š</button><button class="btn" type="button" data-group="rideType" data-value="ä¼šç¤¾">ä¼šç¤¾</button><button class="btn" type="button" data-group="rideType" data-value="äºˆç´„">äºˆç´„</button><button class="btn" type="button" data-group="rideType" data-value="GO">GO</button>
    </div>
  </section>

  <section class="wf-panel" id="sec_payMethod">
    <div class="wf-label">æ”¯æ‰•æ–¹æ³•</div>
    <div class="wf-row">
      <button class="btn" type="button" data-group="payMethod" data-value="ç¾é‡‘">ç¾é‡‘</button><button class="btn" type="button" data-group="payMethod" data-value="QR">QR</button><button class="btn" type="button" data-group="payMethod" data-value="ã‚¯ãƒ¬ã‚«">ã‚¯ãƒ¬ã‚«</button><button class="btn" type="button" data-group="payMethod" data-value="é›»å­M">é›»å­M</button><button class="btn" type="button" data-group="payMethod" data-value="ãƒã‚±ãƒƒãƒˆä»–">ãƒã‚±ãƒƒãƒˆä»–</button><button class="btn" type="button" data-group="payMethod" data-value="GO pay">GO pay</button><button class="btn" type="button" data-group="payMethod" data-value="ä¹—è¾¼GO Pay">ä¹—è¾¼GO Pay</button>
    </div>
  </section>

  <section class="wf-panel is-hidden" id="sec_ticketSub">
    <div class="wf-label">ãƒã‚±ãƒƒãƒˆä»–ï¼ˆè¿½åŠ é¸æŠï¼‰</div>
    <div class="wf-subnote">â€»ã€Œãƒã‚±ãƒƒãƒˆä»–ã€é¸æŠæ™‚ã®ã¿è¡¨ç¤º</div>
    <div class="wf-row">
      <button class="btn" type="button" data-group="ticketSub" data-value="Aãƒã‚±ãƒƒãƒˆ">Aãƒã‚±ãƒƒãƒˆ</button><button class="btn" type="button" data-group="ticketSub" data-value="è‡ªç¤¾ãƒã‚±ãƒƒãƒˆ">è‡ªç¤¾ãƒã‚±ãƒƒãƒˆ</button><button class="btn" type="button" data-group="ticketSub" data-value="è‡¨æ™‚ãƒã‚±ãƒƒãƒˆ">è‡¨æ™‚ãƒã‚±ãƒƒãƒˆ</button><button class="btn" type="button" data-group="ticketSub" data-value="JCBãƒã‚±ãƒƒãƒˆ">JCBãƒã‚±ãƒƒãƒˆ</button><button class="btn" type="button" data-group="ticketSub" data-value="ç¦ç¥‰ãƒã‚±ãƒƒãƒˆ">ç¦ç¥‰ãƒã‚±ãƒƒãƒˆ</button><button class="btn" type="button" data-group="ticketSub" data-value="ç¤¾å†…æ‰±ã„">ç¤¾å†…æ‰±ã„</button><button class="btn" type="button" data-group="ticketSub" data-value="ãã®ä»–">ãã®ä»–</button><button class="btn" type="button" data-group="ticketSub" data-value="GOãƒã‚±ãƒƒãƒˆ">GOãƒã‚±ãƒƒãƒˆ</button>
    </div>
  </section>

  <section class="wf-panel" id="sec_amounts">
    <div class="wf-label">é‡‘é¡å…¥åŠ›</div>
    <div class="wf-form">
      <div class="wf-field" id="row_cash">
        <div class="wf-field-label">ç¾åï¼ˆæ•°å­—ã®ã¿ï¼‰</div>
        <input class="input" id="in_cash" inputmode="none" placeholder="0" readonly aria-readonly="true">
      </div>

      <div class="wf-field" id="row_credit">
        <div class="wf-field-label">æœªåï¼ˆæ•°å­—ã®ã¿ï¼‰</div>
        <input class="input" id="in_credit" inputmode="none" placeholder="0" readonly aria-readonly="true">
      </div>

      <div class="wf-field">
        <div class="wf-field-label">å‚™è€ƒ</div>
        <input class="input" id="in_note" placeholder="ãƒ¡ãƒ¢">
      </div>

      <div class="wf-actions">
        <button class="btn" type="button" id="btn_clear">å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
        <button class="btn" type="button" id="btn_submit">ç™»éŒ²ã™ã‚‹</button>
      </div>
    </div>

    <div class="keypad" id="keypad">
      <div class="note">ãƒ†ãƒ³ã‚­ãƒ¼ï¼ˆé¸æŠä¸­ã®å…¥åŠ›æ¬„ã«å…¥ã‚Šã¾ã™ï¼‰</div>
      <div class="keypad-grid">
        <button class="key" type="button" data-key="1">1</button>
        <button class="key" type="button" data-key="2">2</button>
        <button class="key" type="button" data-key="3">3</button>
        <button class="key" type="button" data-key="4">4</button>
        <button class="key" type="button" data-key="5">5</button>
        <button class="key" type="button" data-key="6">6</button>
        <button class="key" type="button" data-key="7">7</button>
        <button class="key" type="button" data-key="8">8</button>
        <button class="key" type="button" data-key="9">9</button>
        <button class="key small" type="button" data-key="0">0</button>
        <button class="key" type="button" data-key="00">00</button>
        <button class="key small" type="button" data-key="back">BS</button>
      </div>
    </div>
  </section>
</main>

<script>
(() => {
  const REPORT_KEY = "tsms_reports";
  const CURRENT_DAY_KEY = "tsms_report_current_day";
  const state = { rideType: "", payMethod: "", ticketSub: "" };
  const secTicket = document.getElementById("sec_ticketSub");
  const secAmounts = document.getElementById("sec_amounts");
  const rowCash = document.getElementById("row_cash");
  const rowCredit = document.getElementById("row_credit");
  const inCash = document.getElementById("in_cash");
  const inCredit = document.getElementById("in_credit");
  const inNote = document.getElementById("in_note");
  const btnClear = document.getElementById("btn_clear");
  const btnSubmit = document.getElementById("btn_submit");
  let focused = inCash;

  function todayLocalYmd() {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    return `${y}-${m}-${day}`;
  }

  function loadReports() {
    try {
      const list = JSON.parse(localStorage.getItem(REPORT_KEY) || "[]");
      return Array.isArray(list) ? list : [];
    } catch (_) {
      return [];
    }
  }

  function getCurrentDayId() {
    return localStorage.getItem(CURRENT_DAY_KEY) || "";
  }

  function resolveSaveDayId() {
    return getCurrentDayId() || todayLocalYmd();
  }

  function clearSelected(group) {
    document.querySelectorAll(`button[data-group="${group}"]`).forEach((b) => b.classList.remove("is-selected"));
  }

  function selectBtn(group, btn) {
    const already = btn.classList.contains("is-selected");
    clearSelected(group);
    if (already) return false;
    btn.classList.add("is-selected");
    return true;
  }

  function applyPayRules() {
    if (state.payMethod === "ãƒã‚±ãƒƒãƒˆä»–") secTicket.classList.remove("is-hidden");
    else secTicket.classList.add("is-hidden");

    if (state.payMethod === "ç¾é‡‘") {
      rowCash.classList.remove("is-hidden");
      rowCredit.classList.add("is-hidden");
      focused = inCash;
    } else if (state.payMethod === "ãƒã‚±ãƒƒãƒˆä»–") {
      rowCash.classList.remove("is-hidden");
      rowCredit.classList.remove("is-hidden");
      focused = inCredit;
    } else {
      rowCash.classList.add("is-hidden");
      rowCredit.classList.remove("is-hidden");
      focused = inCredit;
    }
  }

  function scrollToAmountsIfReady() {
    if (!state.rideType || !state.payMethod) return;
    if (state.payMethod === "ãƒã‚±ãƒƒãƒˆä»–" && !state.ticketSub) {
      secTicket.scrollIntoView({ behavior: "smooth", block: "start" });
      return;
    }
    setTimeout(() => {
      secAmounts.scrollIntoView({ behavior: "smooth", block: "start" });
      (state.payMethod === "ç¾é‡‘" ? inCash : inCredit).focus();
    }, 50);
  }

  function clearForm() {
    state.rideType = "";
    state.payMethod = "";
    state.ticketSub = "";
    document.querySelectorAll('button[data-group]').forEach((b) => b.classList.remove("is-selected"));
    inCash.value = "";
    inCredit.value = "";
    inNote.value = "";
    rowCash.classList.remove("is-hidden");
    rowCredit.classList.remove("is-hidden");
    secTicket.classList.add("is-hidden");
    focused = inCash;
    inCash.focus();
  }

  document.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-group]");
    if (btn) {
      const g = btn.dataset.group;
      const v = btn.dataset.value || btn.textContent.trim();
      const selected = selectBtn(g, btn);

      if (g === "rideType") state.rideType = selected ? v : "";
      if (g === "payMethod") {
        state.payMethod = selected ? v : "";
        if (!selected) {
          state.ticketSub = "";
          clearSelected("ticketSub");
        }
        applyPayRules();
      }
      if (g === "ticketSub") state.ticketSub = selected ? v : "";

      if (selected) scrollToAmountsIfReady();
      return;
    }

    const keyBtn = e.target.closest("button[data-key]");
    if (!keyBtn || !focused) return;

    const k = keyBtn.dataset.key;
    const cur = String(focused.value || "");
    if (k === "back") focused.value = cur.slice(0, -1);
    else if (k === "00") focused.value = cur + "00";
    else if (/^[0-9]$/.test(k)) focused.value = cur + k;
    focused.focus();
  });

  [inCash, inCredit].forEach((inp) => {
    inp.addEventListener("focus", () => (focused = inp));
    inp.addEventListener("click", () => (focused = inp));
  });

  btnClear.addEventListener("click", () => {
    if (!confirm("å…¥åŠ›å†…å®¹ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ")) return;
    clearForm();
  });

  btnSubmit.addEventListener("click", () => {
    if (!state.rideType || !state.payMethod) {
      alert("ä¹—è»Šç¨®åˆ¥ã¨æ”¯æ‰•æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„");
      return;
    }

    const cash = (inCash.value || "").trim();
    const credit = (inCredit.value || "").trim();
    if (!cash && !credit) {
      alert("ç¾åã‹æœªåã®ã©ã¡ã‚‰ã‹ã«é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
      return;
    }

    if (!confirm("ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ")) return;

    const now = new Date();
    const hh = String(now.getHours()).padStart(2, "0");
    const mm = String(now.getMinutes()).padStart(2, "0");

    const entry = {
      id: (crypto && crypto.randomUUID) ? crypto.randomUUID() : `${Date.now()}-${Math.random().toString(16).slice(2)}`,
      time: `${hh}:${mm}`,
      ts: now.toISOString(),
      rideType: state.rideType,
      payMethod: state.payMethod,
      ticketSub: state.ticketSub || "",
      cash: cash ? Number(cash.replace(/[^0-9]/g, "")) : 0,
      credit: credit ? Number(credit.replace(/[^0-9]/g, "")) : 0,
      note: (inNote.value || "").trim(),
      dayId: resolveSaveDayId()
    };

    const params = new URLSearchParams(location.search);
    const editId = params.get("edit");

    let list = loadReports();

    if (editId) {
      const idx = list.findIndex((x) => x.id === editId);
      if (idx >= 0) {
        entry.id = editId;
        list[idx] = entry;
      } else {
        list.unshift(entry);
      }
    } else {
      list.unshift(entry);
    }

    localStorage.setItem(REPORT_KEY, JSON.stringify(list));
    location.href = "confirm.html";
  });

  (function loadForEdit() {
    const params = new URLSearchParams(location.search);
    const editId = params.get("edit");
    if (!editId) {
      applyPayRules();
      return;
    }

    let list = loadReports();
    const entry = list.find((x) => x.id === editId);
    if (!entry) {
      applyPayRules();
      return;
    }

    state.rideType = entry.rideType || "";
    state.payMethod = entry.payMethod || "";
    state.ticketSub = entry.ticketSub || "";

    ["rideType", "payMethod", "ticketSub"].forEach((group) => {
      const target = state[group];
      if (!target) return;
      document.querySelectorAll(`button[data-group="${group}"]`).forEach((b) => {
        const v = b.dataset.value || b.textContent.trim();
        if (v === target) b.classList.add("is-selected");
      });
    });

    applyPayRules();
    inCash.value = entry.cash ? String(entry.cash) : "";
    inCredit.value = entry.credit ? String(entry.credit) : "";
    inNote.value = entry.note || "";
    focused = inCash;
    setTimeout(scrollToAmountsIfReady, 50);
  })();
})();
</script>

<script>
(function(){
  const menu = document.getElementById("tsmsMenu");
  const bg = document.getElementById("tsmsMenuBg");
  const burger = document.getElementById("tsmsHamburger");
  if(!menu || !bg || !burger) return;

  function openMenu(){ menu.classList.add("open"); bg.classList.add("show"); }
  function closeMenu(){ menu.classList.remove("open"); bg.classList.remove("show"); }

  burger.addEventListener("click", openMenu);
  burger.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openMenu(); });
  bg.addEventListener("click", closeMenu);
  menu.querySelectorAll("a").forEach((a)=>a.addEventListener("click", closeMenu));
})();
</script>

<script>
  (function(){if('serviceWorker' in navigator && location.protocol.indexOf('http')===0){window.addEventListener('load', function(){navigator.serviceWorker.register('./sw.js?v=20260215-1').catch(function(){});});}})();
</script>


<nav class="tsms-bottom-nav" aria-label="ãƒœãƒˆãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
  <a href="report.html" data-tab="report"><span class="ico">ğŸ“</span><span>æ—¥å ±å…¥åŠ›</span></a>
  <a href="confirm.html" data-tab="confirm"><span class="ico">âœ…</span><span>å…¥åŠ›ç¢ºèª</span></a>
  <a href="detail.html" data-tab="detail"><span class="ico">ğŸ“Š</span><span>è©³ç´°ç¢ºèª</span></a>
  <a href="ops.html" data-tab="ops"><span class="ico">ğŸš•</span><span>å‡ºåº«/å¸°åº«</span></a>
  <button type="button" id="tsmsMoreBtn"><span class="ico">â‹¯</span><span>ãã®ä»–</span></button>
</nav>
<div class="tsms-more-bg" id="tsmsMoreBg"></div>
<div class="tsms-more-sheet" id="tsmsMoreSheet" aria-label="ãã®ä»–ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
  <a href="index.html">TOP</a>
  <a href="sales.html">æœˆé–“ç®¡ç†</a>
  <a href="settings.html">è¨­å®š</a>
</div>
<script>
(function(){
  var page=(location.pathname.split('/').pop()||'index.html').replace('.html','');
  document.querySelectorAll('.tsms-bottom-nav [data-tab]').forEach(function(a){
    if(a.getAttribute('data-tab')===page) a.classList.add('active');
  });
  var iconMap={
    report:'<svg viewBox="0 0 24 24"><rect x="4" y="3" width="16" height="18" rx="2"/><path d="M8 8h8M8 12h8M8 16h5"/></svg>',
    confirm:'<svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="m8 12 3 3 5-6"/></svg>',
    detail:'<svg viewBox="0 0 24 24"><path d="M4 19h16"/><rect x="6" y="10" width="3" height="6"/><rect x="11" y="7" width="3" height="9"/><rect x="16" y="5" width="3" height="11"/></svg>',
    ops:'<svg viewBox="0 0 24 24"><rect x="3" y="8" width="18" height="8" rx="2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/><path d="M6 8l2-3h8l2 3"/></svg>',
    more:'<svg viewBox="0 0 24 24"><circle cx="6" cy="7" r="1.5"/><circle cx="6" cy="12" r="1.5"/><circle cx="6" cy="17" r="1.5"/><path d="M10 7h10M10 12h10M10 17h10"/></svg>'
  };
  document.querySelectorAll('.tsms-bottom-nav [data-tab]').forEach(function(a){
    var k=a.getAttribute('data-tab');
    var ico=a.querySelector('.ico');
    if(ico && iconMap[k]) ico.innerHTML=iconMap[k];
  });
  var moreIco=document.querySelector('#tsmsMoreBtn .ico');
  if(moreIco) moreIco.innerHTML=iconMap.more;
  var btn=document.getElementById('tsmsMoreBtn');
  var bg=document.getElementById('tsmsMoreBg');
  var sheet=document.getElementById('tsmsMoreSheet');
  function closeMore(){sheet.classList.remove('show');bg.classList.remove('show');}
  if(btn&&bg&&sheet){
    btn.addEventListener('click',function(){sheet.classList.add('show');bg.classList.add('show');});
    bg.addEventListener('click',closeMore);
  }
  var guard = page==='report';
  function isDirtyReport(){
    var cash=document.getElementById('in_cash');
    var credit=document.getElementById('in_credit');
    var note=document.getElementById('in_note');
    var hasVal=((cash&&cash.value)||(credit&&credit.value)||(note&&note.value));
    var selected=document.querySelector('button[data-group].is-selected');
    return !!(hasVal||selected);
  }
  document.querySelectorAll('.tsms-bottom-nav a, .tsms-more-sheet a').forEach(function(a){
    a.addEventListener('click',function(e){
      if(guard && isDirtyReport() && !confirm('å…¥åŠ›ã‚’ä¸­æ­¢ã—ã¾ã™ã‹ï¼Ÿ')){
        e.preventDefault();
      }
      closeMore();
    });
  });
})();
</script>

</body>
</html>
