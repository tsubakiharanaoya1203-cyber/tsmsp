<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>設定</title>
  <style>
    :root{ --bg:#fff; --text:#111; --muted:#666; --border:#999; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic",sans-serif;
      font-size:18px;
    }
    .main{padding:12px;max-width:880px;margin:0 auto;}
    .section{border:2px solid var(--border);background:#fff;margin:10px 0;padding:10px;}
    .title{font-weight:900;font-size:16px;margin:0 0 8px 0;}
    .note{font-size:12px;color:var(--muted);line-height:1.35;margin:6px 0 10px 0;}
    .field{display:grid;gap:6px;margin-bottom:10px;}
    .label{font-size:13px;color:var(--muted);}
    .input{width:100%;box-sizing:border-box;border:2px solid var(--border);border-radius:0;padding:12px 10px;font-size:18px;background:#fff;}
    .actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .btn{appearance:none;-webkit-appearance:none;border:2px solid var(--border);background:#fff;border-radius:0;padding:12px 8px;font-size:16px;min-height:52px;font-weight:900;}

    .tsms-header{position:sticky;top:0;z-index:100;height:60px;background:#fff;border-bottom:2px solid #000;display:flex;align-items:center;padding:0 14px 0 56px;font-weight:900;font-size:20px;}
    .tsms-hamburger{position:absolute;left:14px;top:50%;transform:translateY(-50%);width:32px;height:24px;display:flex;flex-direction:column;justify-content:space-between;cursor:pointer;user-select:none;}
    .tsms-hamburger span{height:3px;background:#000;display:block;}
    .tsms-menu{position:fixed;top:0;left:0;height:100%;width:280px;background:#fff;border-right:2px solid #000;transform:translateX(-100%);transition:transform .25s ease;z-index:1000;padding-top:60px;}
    .tsms-menu.open{transform:translateX(0);}
    .tsms-menu a{display:block;padding:16px;border-bottom:1px solid #ddd;text-decoration:none;color:#000;font-size:18px;font-weight:900;}
    .tsms-menu small{display:block;margin-top:2px;font-size:12px;font-weight:700;color:#666;}
    .tsms-menu-bg{position:fixed;inset:0;background:rgba(0,0,0,.25);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:900;}
    .tsms-menu-bg.show{opacity:1;pointer-events:auto;}
    .tsms-build{font-size:12px;color:#666;padding:8px 12px;}
  </style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TSMS">
</head>
<body>
<nav class="tsms-menu" id="tsmsMenu" aria-label="サイドメニュー">
  <a href="index.html">TOP<small>メニュー一覧</small></a>
  <a href="report.html">日報入力<small>乗車データを入力</small></a>
  <a href="confirm.html">入力確認<small>当日・過去のデータを確認</small></a>
  <a href="detail.html">詳細確認<small>概算手取、集計結果など</small></a>
  <a href="ops.html">出庫 / 帰庫 / 休憩<small>休憩タイマーなど</small></a>
  <a href="sales.html">月次売上<small>当月、過去の売上確認</small></a>
  <a href="settings.html">設定<small>歩率、締め期間、シフトなど</small></a>
</nav>
<div class="tsms-menu-bg" id="tsmsMenuBg" aria-hidden="true"></div>

<header class="tsms-header">
  <div class="tsms-hamburger" id="tsmsHamburger" role="button" tabindex="0" aria-label="メニュー"><span></span><span></span><span></span></div>
  設定
</header>
<div class="tsms-build"></div>

<main class="main">
  <section class="section">
    <div class="title">歩率・計算設定</div>
    <div class="note">詳細確認ページの概算計算で使う設定です。</div>

    <div class="field"><div class="label">消費税率（%）</div><input class="input" id="taxRate" inputmode="decimal"></div>
    <div class="field"><div class="label">決済手数料率（%）</div><input class="input" id="feeRate" inputmode="decimal"></div>
    <div class="field"><div class="label">GO手配料（円/件）</div><input class="input" id="goFeeYen" inputmode="numeric"></div>
    <div class="field"><div class="label">歩率（%）</div><input class="input" id="walkRate" inputmode="decimal"></div>
  </section>

  <section class="section">
    <div class="title">締め期間・シフト</div>
    <div class="note">現状ある分として保存だけ先に作成しています。</div>

    <div class="field"><div class="label">締め開始日（1〜31）</div><input class="input" id="closeStartDay" inputmode="numeric"></div>
    <div class="field"><div class="label">締め終了日（1〜31）</div><input class="input" id="closeEndDay" inputmode="numeric"></div>
    <div class="field"><div class="label">シフトメモ</div><input class="input" id="shiftNote"></div>

    <div class="actions">
      <button class="btn" id="btnSave" type="button">保存</button>
      <button class="btn" id="btnReset" type="button">初期値に戻す</button>
    </div>
  </section>
</main>

<script>
(function(){
  const KEY = "tsms_settings";
  const defaults = { taxRate:10, feeRate:4, goFeeYen:100, walkRate:50, closeStartDay:1, closeEndDay:31, shiftNote:"" };

  function load(){
    try{
      const x = JSON.parse(localStorage.getItem(KEY) || "null");
      return Object.assign({}, defaults, (x && typeof x === "object") ? x : {});
    }catch(_){ return Object.assign({}, defaults); }
  }
  function save(v){ localStorage.setItem(KEY, JSON.stringify(v)); }

  const ids = ["taxRate","feeRate","goFeeYen","walkRate","closeStartDay","closeEndDay","shiftNote"];
  const els = Object.fromEntries(ids.map(id => [id, document.getElementById(id)]));

  function fill(v){ ids.forEach(id => { if(els[id]) els[id].value = String(v[id] ?? ""); }); }
  function values(){
    const getNum = (id, fallback) => {
      const n = Number((els[id].value || "").trim());
      return Number.isFinite(n) ? n : fallback;
    };
    return {
      taxRate: getNum("taxRate", defaults.taxRate),
      feeRate: getNum("feeRate", defaults.feeRate),
      goFeeYen: getNum("goFeeYen", defaults.goFeeYen),
      walkRate: getNum("walkRate", defaults.walkRate),
      closeStartDay: getNum("closeStartDay", defaults.closeStartDay),
      closeEndDay: getNum("closeEndDay", defaults.closeEndDay),
      shiftNote: (els.shiftNote.value || "").trim()
    };
  }

  fill(load());
  document.getElementById("btnSave").addEventListener("click", ()=>{ save(values()); alert("設定を保存しました"); });
  document.getElementById("btnReset").addEventListener("click", ()=>{ if(!confirm("初期値に戻しますか？")) return; fill(defaults); save(defaults); });
})();
</script>

<script>
(function(){
  const menu = document.getElementById("tsmsMenu");
  const bg = document.getElementById("tsmsMenuBg");
  const burger = document.getElementById("tsmsHamburger");
  if(!menu || !bg || !burger) return;
  function openMenu(){ menu.classList.add("open"); bg.classList.add("show"); }
  function closeMenu(){ menu.classList.remove("open"); bg.classList.remove("show"); }
  burger.addEventListener("click", openMenu);
  burger.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" ") openMenu(); });
  bg.addEventListener("click", closeMenu);
  menu.querySelectorAll("a").forEach((a)=>a.addEventListener("click", closeMenu));
})();
</script>

<script>
  (function(){if('serviceWorker' in navigator && location.protocol.indexOf('http')===0){window.addEventListener('load', function(){navigator.serviceWorker.register('./sw.js').catch(function(){});});}})();
</script>
</body>
</html>
